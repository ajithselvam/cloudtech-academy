<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Microsoft Sentinel Tutorial - GUI Version (Defender Portal Focused)</title>
    <style>
        /* General Styles for the Tutorial Page */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.7;
            color: #1a202c;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 60px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        h1 {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        h2 {
            color: #2d3748;
            font-size: 2rem;
            font-weight: 700;
            margin: 50px 0 25px 0;
            position: relative;
            padding-left: 25px;
            z-index: 1;
        }
        
        h2::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 6px;
            height: 40px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 3px;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }
        
        h3 {
            color: #4a5568;
            font-size: 1.4rem;
            font-weight: 600;
            margin: 30px 0 15px 0;
            position: relative;
            z-index: 1;
        }
        
        h4 {
            color: #667eea;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 25px 0 10px 0;
            position: relative;
            z-index: 1;
        }
        
        p {
            margin-bottom: 16px;
            font-size: 1.1rem;
            color: #4a5568;
            position: relative;
            z-index: 1;
        }
        
        code {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            color: #667eea;
            padding: 4px 8px;
            border-radius: 6px;
            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            font-weight: 500;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        pre {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: #e2e8f0;
            padding: 30px;
            border-radius: 16px;
            overflow-x: auto;
            margin: 25px 0;
            border: 1px solid #4a5568;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }
        
        pre::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 16px 16px 0 0;
        }
        
        pre code {
            background: none;
            color: inherit;
            padding: 0;
            border: none;
            box-shadow: none;
            font-size: 0.95em;
        }
        
        .toc {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 50px;
            border: 1px solid rgba(102, 126, 234, 0.2);
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.15);
            position: relative;
            z-index: 1;
        }
        
        .toc h2 {
            margin-top: 0;
            color: #667eea;
            text-align: center;
        }
        
        .toc ul {
            list-style: none;
            padding: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .toc li {
            margin: 0;
            transition: transform 0.3s ease;
        }
        
        .toc li:hover {
            transform: translateX(5px);
        }
        
        .toc a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            padding: 12px 16px;
            border-radius: 8px;
            display: block;
            background: rgba(255, 255, 255, 0.7);
            transition: all 0.3s ease;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }
        
        .toc a:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        .highlight {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 5px solid #ffc107;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2);
            position: relative;
            z-index: 1;
        }
        
        .tip {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 5px solid #28a745;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.2);
            position: relative;
            z-index: 1;
        }
        
        .tip::before {
            content: 'üí°';
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 1.5rem;
        }
        
        .tip {
            padding-left: 50px;
        }
        
        .warning {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 5px solid #dc3545;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.2);
            position: relative;
            z-index: 1;
        }
        
        .warning::before {
            content: '‚ö†Ô∏è';
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 1.5rem;
        }
        
        .warning {
            padding-left: 50px;
        }
        
        ol, ul {
            margin-left: 25px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        ol li, ul li {
            margin-bottom: 8px;
            font-size: 1.1rem;
            color: #4a5568;
        }
        
        /* Syntax highlighting for code blocks */
        pre code .comment { color: #8b949e; }
        pre code .keyword { color: #ff7b72; }
        pre code .string { color: #a5d6ff; }
        pre code .number { color: #79c0ff; }
        pre code .operator { color: #ff7b72; }
        
        /* Responsive design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 30px 20px;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            h2 {
                font-size: 1.7rem;
            }
            
            .toc ul {
                grid-template-columns: 1fr;
            }
        }
        
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
        
        /* Loading animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .container {
            animation: fadeIn 0.8s ease-out;
        }
        
        /* Interactive elements */
        .interactive-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(102, 126, 234, 0.2);
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }
        
        .interactive-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }
        
        @media print {
            body { 
                background: white; 
                color: black;
            }
            .container { 
                box-shadow: none; 
                background: white;
            }
            pre { 
                background-color: #f4f4f4; 
                color: #333; 
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Complete Microsoft Sentinel Tutorial - GUI Version</h1>
        
        <div class="toc">
            <h2>Table of Contents</h2>
            <ul>
                <li><a href="#what-is-microsoft-sentinel">1. What is Microsoft Sentinel?</a></li>
                <li><a href="#key-features-and-benefits">2. Key Features and Benefits</a></li>
                <li><a href="#architecture-and-components">3. Architecture & Components</a></li>
                <li><a href="#initial-setup-and-onboarding">4. Initial Setup & Onboarding</a></li>
                <li><a href="#data-connectors">5. Data Connectors</a></li>
                <li><a href="#logs-and-kql">6. Logs (Log Analytics Workspace) & KQL</a></li>
                <li><a href="#analytics-rules">7. Analytics Rules (Detections)</a></li>
                <li><a href="#incidents-and-investigation">8. Incidents & Investigation</a></li>
                <li><a href="#hunting">9. Hunting</a></li>
                <li><a href="#automation-and-orchestration">10. Automation (Playbooks & Automation Rules)</a></li>
                <li><a href="#workbooks-and-dashboards">11. Workbooks & Dashboards</a></li>
                <li><a href="#threat-intelligence">12. Threat Intelligence</a></li>
                <li><a href="#ueba">13. User & Entity Behavior Analytics (UEBA)</a></li>
                <li><a href="#cost-management">14. Cost Management</a></li>
                <li><a href="#best-practices-and-troubleshooting">15. Best Practices & Troubleshooting</a></li>
            </ul>
        </div>

        <h2 id="what-is-microsoft-sentinel">1. What is Microsoft Sentinel?</h2>
        <p><strong>Microsoft Sentinel</strong> is a scalable, cloud-native **Security Information and Event Management (SIEM)** and **Security Orchestration, Automation, and Response (SOAR)** solution. It provides intelligent security analytics and threat intelligence across an enterprise, offering a single solution for alert detection, threat visibility, proactive hunting, and automated threat response.</p>
        <p>Built on top of **Azure Log Analytics**, Sentinel leverages Microsoft's vast threat intelligence, AI, and machine learning capabilities to help security operations teams efficiently protect their digital assets in both cloud and on-premises environments.</p>
        <div class="tip">
            **Important Note on Portals:** As of July 2025, Microsoft is increasingly moving Sentinel experiences into the **Microsoft Defender portal** for a unified security operations experience. This tutorial will primarily focus on the Defender portal GUI, but some initial setup and deep dive into Log Analytics will still involve the Azure portal.
        </div>

        <h2 id="key-features-and-benefits">2. Key Features and Benefits</h2>
        <ul>
            <li><strong>Collect Data at Cloud Scale:</strong> Ingests data from various sources (Microsoft 365, Azure services, on-premises, other clouds, third-party security solutions).</li>
            <li><strong>Detect Threats with Smart Analytics:</strong> Uses built-in rules, machine learning, and behavioral analytics to identify known and unknown threats.</li>
            <li><strong>Investigate Threats with AI:</strong> Leverages AI to reduce alert fatigue by correlating raw alerts into actionable incidents, and provides powerful investigation graphs.</li>
            <li><strong>Automate Response with SOAR:</strong> Built-in playbooks (Azure Logic Apps) enable automated responses to threats, accelerating remediation.</li>
            <li><strong>Proactive Threat Hunting:</strong> Allows security analysts to proactively search for undiscovered threats using powerful Kusto Query Language (KQL).</li>
            <li><strong>Cloud-Native & Scalable:</strong> Pay-as-you-go model, scales infinitely with your data ingestion needs.</li>
            <li><strong>Unified Visibility:</strong> Centralizes security data from diverse sources into a single pane of glass.</li>
        </ul>

        <h2 id="architecture-and-components">3. Architecture & Components</h2>
        <p>Microsoft Sentinel's architecture is built on Azure services, primarily Azure Log Analytics.</p>
        <ul>
            <li><strong>Azure Log Analytics Workspace:</strong>
                <ul>
                    <li>The central **data repository** for Sentinel. All data ingested into Sentinel is stored here.</li>
                    <li>Uses **Kusto Query Language (KQL)** for querying and analyzing log data.</li>
                </ul>
            </li>
            <li><strong>Data Connectors:</strong> Mechanisms to ingest data from various sources into the Log Analytics Workspace.</li>
            <li><strong>Analytics Rules:</strong> Define logic to detect threats by analyzing incoming data. These generate alerts and incidents.</li>
            <li><strong>Incidents:</strong> Correlated groups of alerts representing potential security threats.</li>
            <li><strong>Workbooks:</strong> Interactive dashboards for data visualization and custom reporting.</li>
            <li><strong>Hunting Queries:</strong> Pre-built or custom KQL queries to proactively search for threats.</li>
            <li><strong>Playbooks (Azure Logic Apps):</strong> Automated workflows triggered by Sentinel incidents or alerts.</li>
            <li><strong>Threat Intelligence:</strong> Integrates with various threat intelligence feeds.</li>
            <li><strong>User and Entity Behavior Analytics (UEBA):</strong> Identifies anomalous behavior by users and entities.</li>
        </ul>

        <h2 id="initial-setup-and-onboarding">4. Initial Setup & Onboarding</h2>
        <p>Setting up Microsoft Sentinel involves deploying it to an Azure subscription and configuring a Log Analytics Workspace.</p>
        <h3>Prerequisites:</h3>
        <ul>
            <li>An Azure subscription. If you don't have one, create a free account.</li>
            <li>Contributor permissions on the Azure subscription where Sentinel will be deployed.</li>
            <li>A Log Analytics Workspace.</li>
        </ul>
        <h3>Steps to Onboard Microsoft Sentinel (Azure Portal):</h3>
        <ol>
            <li><strong>Log in to the Azure Portal:</strong> <a href="https://portal.azure.com" target="_blank">portal.azure.com</a></li>
            <li><strong>Create/Select a Log Analytics Workspace:</strong>
                <ul>
                    <li>In the Azure Portal search bar, type `Log Analytics workspaces` and select it.</li>
                    <li>Click **+ Create** or select an existing one.</li>
                    <li>If creating, provide **Subscription**, **Resource Group**, **Name**, **Region**. Set a suitable pricing tier (e.g., Pay-as-you-go). Click **Review + create** &gt; **Create**.</li>
                </ul>
            </li>
            <li><strong>Enable Microsoft Sentinel:</strong>
                <ul>
                    <li>In the Azure Portal search bar, type `Microsoft Sentinel` and select it.</li>
                    <li>Click **+ Create Microsoft Sentinel**.</li>
                    <li>Select the Log Analytics workspace you created or chose.</li>
                    <li>Click **Add**.</li>
                </ul>
            </li>
            <li><strong>Grant Permissions:</strong> After onboarding, assign appropriate roles for your security team members in the Azure portal for the Log Analytics Workspace (e.g., `Microsoft Sentinel Contributor`, `Microsoft Sentinel Responder`).
                <ul>
                    <li>Go to your Log Analytics Workspace &gt; **Access control (IAM)** &gt; **+ Add** &gt; **Add role assignment**.</li>
                    <li>Select the role (e.g., `Microsoft Sentinel Contributor`), assign to a user or group, and click **Save**.</li>
                </ul>
            </li>
        </ol>
        <div class="tip">
            **Accessing Sentinel in Defender Portal:** Once onboarded, you can access Sentinel by signing into the <a href="https://security.microsoft.com/" target="_blank">Microsoft Defender portal</a> and navigating to **Microsoft Sentinel** in the left navigation pane.
        </div>

        <h2 id="data-connectors">5. Data Connectors</h2>
        <p>Data connectors are the pipelines that ingest data from various sources into your Log Analytics Workspace for Sentinel to analyze.</p>
        <h3>A. Types of Data Connectors:</h3>
        <ul>
            <li><strong>Microsoft Services:</strong> Azure Active Directory, Microsoft 365 logs (Audit, SharePoint), Microsoft Defender XDR, Azure Firewall. (Often direct, service-to-service integration).</li>
            <li><strong>External Solutions (APIs):</strong> AWS CloudTrail, Google Workspace, CrowdStrike. (May involve Azure Logic Apps or Functions).</li>
            <li><strong>Industry Standard Protocols:</strong> Syslog, Common Event Format (CEF) from firewalls, proxies, EDRs, etc. (Requires a Linux-based Log Analytics agent/forwarder).</li>
            <li><strong>Custom Logs:</strong> For any application or system not covered by built-in connectors.</li>
        </ul>
        <h3>B. Connecting Data Sources (GUI - Defender Portal):</h3>
        <ol>
            <li><strong>Navigate to Data connectors:</strong>
                <pre><code>Microsoft Defender portal &gt; Microsoft Sentinel &gt; Content management &gt; Data connectors</code></pre>
            </li>
            <li><strong>Connecting an Azure Service (e.g., Azure Active Directory):</strong>
                <ul>
                    <li>Search for `Azure Active Directory` connector.</li>
                    <li>Click on the connector and then click **Open connector page**.</li>
                    <li>Review the prerequisites and instructions. Typically, you'll just click **Connect** for Azure AD logs (e.g., `Audit logs`, `Sign-in logs`).</li>
                    <li>Verify the "Status" shows as `Connected`.</li>
                </ul>
            </li>
            <li><strong>Connecting Microsoft 365 (Audit logs):</strong>
                <ul>
                    <li>Search for `Microsoft 365` connector.</li>
                    <li>Click **Open connector page**.</li>
                    <li>Check the boxes for the logs you want to collect (e.g., `Exchange`, `SharePoint`, `Teams`, `Audit logs (all activities)`).</li>
                    <li>Click **Connect**.</li>
                </ul>
            </li>
            <li><strong>Connecting Syslog/CEF (e.g., from a Linux server/firewall):</strong>
                <ul>
                    <li>Search for `Syslog` or `Common Event Format (CEF)` connector.</li>
                    <li>Click **Open connector page**.</li>
                    <li>Follow the step-by-step instructions provided to deploy a Linux-based Log Analytics agent (often referred to as a "Log Forwarder") on a dedicated VM, and configure it to send Syslog/CEF data to that agent.</li>
                    <li>Verify data ingestion by checking the "Status" and by navigating to **Logs** and running a basic query (e.g., `Syslog | take 10` or `CommonSecurityLog | take 10`).</li>
                </ul>
            </li>
        </ol>
        <div class="tip">
            **Content Hub:** Many data connectors come as part of "Solutions" in the Content Hub. You can browse and install full solutions (which include connectors, analytics rules, workbooks, etc.) from:
            <pre><code>Microsoft Defender portal &gt; Microsoft Sentinel &gt; Content management &gt; Content hub</code></pre>
        </div>

        <h2 id="logs-and-kql">6. Logs (Log Analytics Workspace) & KQL</h2>
        <p>All your Sentinel data resides in your Azure Log Analytics workspace. **Kusto Query Language (KQL)** is the powerful query language used to interact with this data.</p>
        <h3>A. Accessing Logs (Defender Portal):</h3>
        <pre><code>Microsoft Defender portal &gt; Microsoft Sentinel &gt; General &gt; Logs</code></pre>
        <p>This opens the Log Analytics query interface where you can write and execute KQL queries.</p>
        <h3>B. Basic KQL Syntax (GUI Examples):</h3>
        <ol>
            <li><strong>Basic Query & Run:</strong>
                <ul>
                    <li>In the query editor, type `SigninLogs` (if you connected AAD logs).</li>
                    <li>Click **Run**. You'll see the latest sign-in logs.</li>
                </ul>
                <pre><code class="language-kql">SigninLogs</code></pre>
            </li>
            <li><strong>Filtering Data:</strong>
                <ul>
                    <li>Add a `| where` clause.</li>
                    <li>Example: To see only failed sign-ins.
                        <pre><code class="language-kql">SigninLogs
| where ResultType == 50126 // 50126 is a common code for failed sign-ins</code></pre>
                    </li>
                </ul>
            </li>
            <li><strong>Projecting Columns:</strong>
                <ul>
                    <li>Use `| project` to select specific columns.
                        <pre><code class="language-kql">SigninLogs
| where ResultType == 50126
| project TimeGenerated, Identity, IPAddress, Location, ResultDescription</code></pre>
                    </li>
                </ul>
            </li>
            <li><strong>Summarizing Data:</strong>
                <ul>
                    <li>Use `| summarize` for aggregation.
                        <pre><code class="language-kql">SigninLogs
| where TimeGenerated &gt; ago(7d)
| summarize FailedAttempts = count() by IPAddress, Identity
| where FailedAttempts &gt; 5
| order by FailedAttempts desc</code></pre>
                    </li>
                </ul>
            </li>
        </ol>
        <div class="tip">
            **KQL Learning:** Microsoft Learn offers excellent resources for learning KQL. The Log Analytics interface itself provides Intellisense (auto-completion) and schema exploration (left pane showing available tables and columns).
        </div>

        <h2 id="analytics-rules">7. Analytics Rules (Detections)</h2>
        <p>Analytics rules define logic to detect specific threats or suspicious activities in your ingested data, generating alerts and incidents.</p>
        <h3>A. Types of Analytics Rules:</h3>
        <ul>
            <li><strong>Scheduled query:</strong> Runs a KQL query on a set schedule, generating an alert if conditions are met. (Most common and what we'll demonstrate).</li>
            <li><strong>Microsoft incident creation rule:</strong> Automatically creates incidents from alerts generated by Microsoft security products (e.g., Defender for Endpoint).</li>
            <li><strong>Fusion:</strong> Uses Microsoft's AI to correlate multiple low-fidelity alerts into high-fidelity incidents.</li>
            <li><strong>Machine learning (ML) behavior analytics:</strong> Pre-built ML models that detect anomalous behavior (e.g., impossible travel).</li>
            <li><strong>Microsoft security:</strong> Connects alerts from Microsoft services (e.g., Microsoft Defender for Cloud Apps).</li>
        </ul>
        <h3>B. Creating a Scheduled Query Rule (GUI - Defender Portal):</h3>
        <p>Let's create a rule to detect multiple failed sign-in attempts from a single IP.</p>
        <ol>
            <li><strong>Navigate to Analytics rules:</strong>
                <pre><code>Microsoft Defender portal &gt; Microsoft Sentinel &gt; Configuration &gt; Analytics rules</code></pre>
            </li>
            <li><strong>Create Rule:</strong>
                <ul>
                    <li>Click **+ Create** &gt; **Scheduled query rule**.</li>
                    <li><strong>General tab:</strong>
                        <ul>
                            <li><strong>Name:</strong> `Brute Force Attempt from Single IP`.</li>
                            <li><strong>Description:</strong> `Detects multiple failed sign-in attempts from a unique IP address to different user accounts within a short period.`</li>
                            <li><strong>Tactics:</strong> Select relevant MITRE ATT&CK tactics (e.g., `Credential Access`, `Initial Access`).</li>
                            <li><strong>Severity:</strong> `High`.</li>
                            <li><strong>Status:</strong> `Enabled`.</li>
                        </ul>
                    </li>
                    <li>Click **Next: Set rule logic**.</li>
                    <li><strong>Set rule logic tab:</strong>
                        <ul>
                            <li><strong>Rule query:</strong> Paste your KQL query here.
                                <pre><code class="language-kql">SigninLogs
| where ResultType == 50126 // Common failed login result code
| summarize FailedLogons = count(), AccountList = make_set(Identity) by IPAddress, bin(TimeGenerated, 5m)
| where FailedLogons &gt; 10 // Threshold for failed attempts
| extend StartTime = min(TimeGenerated), EndTime = max(TimeGenerated)
| project IPAddress, FailedLogons, AccountList, StartTime, EndTime
| order by FailedLogons desc</code></pre>
                            </li>
                            <li><strong>Entity mapping:</strong> Click **+ Add new entity**. Map relevant entities from your query results (e.g., `IPAddress` to `IP address`, `Identity` (from `AccountList`) to `Account`). This is crucial for the investigation graph.</li>
                            <li><strong>Custom details:</strong> Click **+ Add new custom detail**. Map query fields to alert details (e.g., `FailedLogons` to "Failed Logons Count").</li>
                            <li><strong>Query scheduling:</strong>
                                <ul>
                                    <li><strong>Run query every:</strong> `5 minutes`.</li>
                                    <li><strong>Lookup data from the last:</strong> `5 minutes`.</li>
                                </ul>
                            </li>
                            <li><strong>Alert threshold:</strong> `Generate alert when number of query results is greater than 0`.</li>
                            <li><strong>Event grouping:</strong> `Group all events into a single alert` (default).</li>
                        </ul>
                    </li>
                    <li>Click **Next: Incident settings**.</li>
                    <li><strong>Incident settings tab:</strong>
                        <ul>
                            <li>**Automated incident creation:** Ensure `Create incidents from alerts triggered by this analytics rule` is set to `Enabled`.</li>
                            <li>**Alert grouping:** (Optional) Configure how alerts are grouped into incidents (e.g., by IP address within 1 hour).</li>
                        </ul>
                    </li>
                    <li>Click **Next: Automated response**.</li>
                    <li><strong>Automated response tab:</strong> (Optional, see Automation section).</li>
                    <li>Click **Next: Review and create**.</li>
                    <li>Click **Create**.</li>
                </ul>
            </li>
        </ol>
        <div class="tip">
            **Testing Rules:** After creating a rule, it's good practice to generate some test data (e.g., deliberately fail logins from an IP) and monitor if the alert and incident are generated as expected.
        </div>

        <h2 id="incidents-and-investigation">8. Incidents & Investigation</h2>
        <p>When analytics rules trigger alerts, and related alerts are automatically correlated into **incidents**. Incidents are the primary focus for security analysts.</p>
        <h3>A. Managing Incidents (GUI - Defender Portal):</h3>
        <ol>
            <li><strong>Navigate to Incidents:</strong>
                <pre><code>Microsoft Defender portal &gt; Microsoft Sentinel &gt; Threat management &gt; Incidents</code></pre>
            </li>
            <li><strong>View Incident Queue:</strong>
                <ul>
                    <li>You'll see a table listing all incidents, their severity, status (New, Active, Closed), owner, and entities involved.</li>
                    <li>Use filters at the top to narrow down the incidents (e.g., filter by severity, status, owner).</li>
                </ul>
            </li>
            <li><strong>Assign & Status:</strong> Select an incident, and use the options at the top to **Assign** it to yourself or another team member, and change its **Status** (e.g., from `New` to `Active`).</li>
        </ol>
        <h3>B. Incident Investigation (GUI - Defender Portal):</h3>
        <p>Click on an incident to open the full investigation details.</p>
        <ol>
            <li><strong>Overview Tab:</strong> Provides a summary, related alerts, entities involved, and MITRE ATT&CK tactics.</li>
            <li><strong>Alerts Tab:</strong> Lists all individual alerts associated with this incident. Click on an alert to see its raw data.</li>
            <li><strong>Entities Tab:</strong> Shows all users, hosts, IP addresses, processes, etc., that Sentinel has identified as relevant to the incident. These are crucial for the investigation graph.</li>
            <li><strong>Timeline Tab:</strong> Displays a chronological sequence of events and alerts related to the entities in the incident.</li>
            <li><strong>Investigation Graph:</strong>
                <ul>
                    <li>Click the **Investigate** button from the incident overview page. This opens a visual representation of the incident.</li>
                    <li>Nodes represent entities (users, devices, IPs) and alerts. Lines show relationships.</li>
                    <li>Click on an entity node (e.g., an IP address) to view its details in the side pane.</li>
                    <li>Hover over an entity to reveal "Exploration Queries" ‚Äì pre-defined queries to expand your investigation (e.g., "Related alerts," "Logon events"). Click to run them and add results to the graph.</li>
                    <li>You can expand nodes, drag entities around, and use the timeline at the bottom to focus on specific timeframes.</li>
                </ul>
            </li>
            <li><strong>Audit Log & Comments:</strong> Add notes and observations to the incident's "Audit log" for collaboration and record-keeping.</li>
            <li><strong>Actions:</strong> From the incident page, you can take various actions like running playbooks manually, creating a new hunting query from an entity, or closing the incident.</li>
        </ol>

        <h2 id="hunting">9. Hunting</h2>
        <p>Threat hunting is the proactive search for threats that are currently undetected by existing security controls. Sentinel's Hunting capabilities empower security analysts to do this.</p>
        <ol>
            <li><strong>Navigate to Hunting:</strong>
                <pre><code>Microsoft Defender portal &gt; Microsoft Sentinel &gt; Threat management &gt; Hunting</code></pre>
            </li>
            <li><strong>Explore Hunting Queries (Queries tab):</strong>
                <ul>
                    <li>You'll see a library of pre-built hunting queries, often based on known TTPs (e.g., "PowerShell Empire Usage," "Unusual Azure AD Signins").</li>
                    <li>Filter queries by Tactics, Data sources, or Tags.</li>
                    <li>Click the **Run query** button next to a query to execute it.</li>
                    <li>The results will appear at the bottom. You can then refine the query in the Logs interface or take action.</li>
                </ul>
            </li>
            <li><strong>Create Custom Hunting Queries:</strong>
                <ul>
                    <li>From the Hunting page, click **+ New query**.</li>
                    <li>This opens the Logs interface where you can write your own KQL queries.</li>
                    <li>Once satisfied with your query, you can **Save** it as a new hunting query, or promote it to an analytics rule.</li>
                </ul>
            </li>
            <li><strong>Bookmarks:</strong>
                <ul>
                    <li>When running a hunting query in the Logs interface, if you find interesting events, you can "bookmark" them.</li>
                    <li>Select the relevant rows from the results, then click **Add bookmark** from the top bar.</li>
                    <li>Provide a name, notes, and map entities. This creates a record of your findings in the **Bookmarks** tab of the Hunting page.</li>
                    <li>From a bookmark, you can create a new incident or add it to an existing incident.</li>
                </ul>
            </li>
        </ol>

        <h2 id="automation-and-orchestration">10. Automation (Playbooks & Automation Rules)</h2>
        <p>Automation in Sentinel consists of **Playbooks** (Azure Logic Apps for automated workflows) and **Automation Rules** (to automatically triage incidents and trigger playbooks).</p>
        <h3>A. Playbooks (Azure Logic Apps) - GUI Usage:</h3>
        <p>Automated, scalable, and customizable workflows triggered by Sentinel alerts or incidents.</p>
        <ol>
            <li><strong>Navigate to Automation:</strong>
                <pre><code>Microsoft Defender portal &gt; Microsoft Sentinel &gt; Configuration &gt; Automation</code></pre>
            </li>
            <li><strong>Create Playbook:</strong>
                <ul>
                    <li>Go to the **Playbooks** tab.</li>
                    <li>Click **+ Create** &gt; **Blank playbook**. (This opens the Azure Logic App designer in a new browser tab).</li>
                    <li><strong>Basics:</strong> Select **Subscription**, **Resource Group**, **Playbook name** (e.g., `BlockIPandNotify`). **Region**. Select **Plan type** (`Consumption` is typical).</li>
                    <li>Click **Review + create** &gt; **Create**.</li>
                    <li>Once deployed, click **Go to resource** to open the Logic App designer.</li>
                    <li><strong>Choose a trigger:</strong> Search for `Microsoft Sentinel` and select "When a Microsoft Sentinel incident is created".</li>
                    <li><strong>Add actions:</strong>
                        <ul>
                            <li>Click **+ New step**. Search for an action (e.g., `Azure Firewall - Block IP address list`). Configure the action (firewall details, IP address from dynamic content of the incident entity).</li>
                            <li>Add another action (e.g., `Office 365 Outlook - Send an email (V2)`). Configure sender, recipient, subject (`Incident: @{triggerBody()?['properties']?['AlertDisplayName']}`), and body using dynamic content from the incident.</li>
                        </ul>
                    </li>
                    <li>**Save** the Logic App.</li>
                    <li><strong>Grant Permissions:</strong> Back in the Azure Portal (not Defender portal), navigate to your **Log Analytics Workspace** &gt; **Access control (IAM)** &gt; **+ Add** &gt; **Add role assignment**. Grant the Logic App's Managed Identity (you'll find its name under "System assigned managed identity" in the Logic App's Identity blade) necessary permissions (e.g., `Azure Firewall Contributor` if blocking IPs, `Microsoft Sentinel Responder` if updating incident).</li>
                </ul>
            </li>
        </ol>
        <h3>B. Automation Rules - GUI Usage:</h3>
        <p>Define rules to automatically triage incidents or trigger playbooks.</p>
        <ol>
            <li><strong>Navigate to Automation rules:</strong>
                <pre><code>Microsoft Defender portal &gt; Microsoft Sentinel &gt; Configuration &gt; Automation</code></pre>
            </li>
            <li><strong>Create Automation Rule:</strong>
                <ul>
                    <li>Go to the **Automation rules** tab.</li>
                    <li>Click **+ Create** &gt; **Automation rule**.</li>
                    <li>**Rule name:** (e.g., `Trigger Block IP Playbook for Brute Force`).</li>
                    <li>**Trigger:** `When incident is created`.</li>
                    <li>**Conditions:** Add conditions to specify which incidents this rule applies to (e.g., `Analytics rule name` `Contains` `Brute Force Attempt from Single IP`).</li>
                    <li>**Actions:**
                        <ul>
                            <li>Select `Run playbook`.</li>
                            <li>Choose your `BlockIPandNotify` playbook.</li>
                        </ul>
                    </li>
                    <li>Configure **Rule expiration** and **Order**.</li>
                    <li>Click **Apply**.</li>
                </ul>
            </li>
        </ol>
        <p>Now, when your "Brute Force Attempt from Single IP" analytics rule creates an incident, this automation rule will automatically trigger your "BlockIPandNotify" playbook.</p>

        <h2 id="workbooks-and-dashboards">11. Workbooks & Dashboards</h2>
        <p>Workbooks provide flexible and interactive canvases for data analysis and rich visualizations within Sentinel.</p>
        <ol>
            <li><strong>Navigate to Workbooks:</strong>
                <pre><code>Microsoft Defender portal &gt; Microsoft Sentinel &gt; Threat management &gt; Workbooks</code></pre>
            </li>
            <li><strong>Explore Templates:</strong>
                <ul>
                    <li>Go to the **Templates** tab.</li>
                    <li>Browse pre-built workbook templates for various data sources (e.g., Azure AD Sign-ins, Firewall logs).</li>
                    <li>Click on a template, then click **Save** to create a saved instance of the workbook in your workspace.</li>
                </ul>
            </li>
            <li><strong>Create Custom Workbook:</strong>
                <ul>
                    <li>Go to the **My workbooks** (or **Shared reports**) tab.</li>
                    <li>Click **+ Add workbook**.</li>
                    <li>This opens an empty workbook. Click **Edit**.</li>
                    <li>Click **Add** &gt; **Add query**.
                        <ul>
                            <li><strong>Data source:</strong> `Logs`.</li>
                            <li><strong>Resource type:</strong> `Log Analytics`.</li>
                            <li><strong>Workspace:</strong> Select your Sentinel workspace.</li>
                            <li>**KQL Query:** (e.g., `SigninLogs | summarize count() by ResultType | render piechart with (title="Sign-in Result Types")`).</li>
                            <li>Click **Run Query**.</li>
                            <li>Choose a **Visualization** type (e.g., `Pie chart`, `Bar chart`, `Grid`).</li>
                            <li>Click **Done editing**.</li>
                        </ul>
                    </li>
                    <li>Add other elements like **Text**, **Parameters** (for interactive filters), **Links**.</li>
                    <li>Click **Save** (top toolbar). Provide a **Workbook name**, **Subscription**, **Resource group**, and **Location**. Click **Save**.</li>
                </ul>
            </li>
        </ol>

        <h2 id="threat-intelligence">12. Threat Intelligence</h2>
        <p>Sentinel can ingest threat intelligence feeds to enrich your data and enhance detections, hunting, and investigations.</p>
        <ol>
            <li><strong>Navigate to Threat intelligence:</strong>
                <pre><code>Microsoft Defender portal &gt; Microsoft Sentinel &gt; Threat management &gt; Threat intelligence</code></pre>
            </li>
            <li><strong>Manage Indicators:</strong>
                <ul>
                    <li>You'll see a list of ingested threat indicators.</li>
                    <li>Click **+ Add new** to manually add indicators (e.g., a known malicious IP, domain, or file hash).</li>
                </ul>
            </li>
            <li><strong>Data Connectors for TI:</strong>
                <ul>
                    <li>Go to **Data connectors** and search for `Threat Intelligence - TAXII` (for STIX/TAXII feeds) or `Microsoft Defender Threat Intelligence`.</li>
                    <li>Follow the instructions on the connector page to configure ingestion from external TI platforms.</li>
                </ul>
            </li>
            <li><strong>Using TI in Analytics Rules/Hunting:</strong> Indicators ingested into Sentinel populate the `ThreatIntelligenceIndicator` table, which you can use in your KQL queries.
                <pre><code class="language-kql"># Example: Find events matching ingested malicious IPs
CommonSecurityLog
| where TimeGenerated &gt; ago(1d)
| where DestinationIP in (ThreatIntelligenceIndicator | where Description contains "Malicious_IP_Feed" | project NetworkIP)</code></pre>
            </li>
        </ol>

        <h2 id="ueba">13. User & Entity Behavior Analytics (UEBA)</h2>
        <p>UEBA in Sentinel helps detect subtle, complex, and insider threats by identifying anomalous behavior from users and other entities (hosts, applications).</p>
        <ol>
            <li><strong>How it Works:</strong> Sentinel builds a baseline of normal behavior for each user/entity. Deviations from this baseline trigger alerts and are surfaced in entity pages.</li>
            <li><strong>Access Entity Pages:</strong>
                <ul>
                    <li>From an incident, click on an **entity** (e.g., a user's name or a device name). This will open the Entity page in the Defender portal (or Azure AD for users).</li>
                    <li>The **Timeline** tab on the entity page will show a consolidated view of activities and alerts associated with that entity, including UEBA-driven anomalies.</li>
                    <li>Insights based on UEBA data are also visible on the **Overview** dashboard and within certain workbooks.</li>
                </ul>
            </li>
            <li><strong>Configuration:</strong> UEBA functionality is largely enabled by connecting relevant data sources (e.g., Azure Active Directory Sign-in and Audit Logs, Windows Security Events, Syslog). Ensure your analytics rules map entities correctly.</li>
        </ol>

        <h2 id="cost-management">14. Cost Management</h2>
        <p>Understanding and managing Sentinel costs is important as it's a pay-as-you-go service based primarily on data ingestion and data retention.</p>
        <ol>
            <li><strong>Primary Cost Driver:</strong> Data Ingestion (per GB).</li>
            <li><strong>Monitoring Costs (Azure Portal):</strong>
                <pre><code>Azure Portal &gt; Subscription &gt; Cost analysis</code></pre>
                <ul>
                    <li>Filter by `Resource type` to see costs for `Log Analytics workspace` and `Microsoft Sentinel`.</li>
                </ul>
                <pre><code>Azure Portal &gt; Log Analytics workspace &gt; Usage and estimated costs</code></pre>
                <ul>
                    <li>Provides detailed breakdown of ingested data by solution (e.g., `SecurityInsights` for Sentinel, `Security` for Defender for Cloud).</li>
                </ul>
            </li>
            <li><strong>Cost Optimization Strategies:</strong>
                <ul>
                    <li><strong>Filter data at source:</strong> Use data connector configurations or Log Analytics agent settings to only ingest necessary logs.</li>
                    <li><strong>Daily Cap:</strong> Set a daily ingestion cap on your Log Analytics Workspace (Azure Portal &gt; Log Analytics workspace &gt; Usage and estimated costs &gt; Daily cap). This prevents unexpected spikes but can impact security visibility if reached.</li>
                    <li><strong>Retention Period:</strong> Adjust log retention to balance cost and compliance needs (Azure Portal &gt; Log Analytics workspace &gt; Usage and estimated costs &gt; Data retention).</li>
                    <li><strong>Pricing Tiers:</strong> Consider commitment tiers for predictable, high-volume ingestion.</li>
                    <li><strong>Tune Analytics Rules:</strong> Reduce false positives that generate unnecessary alerts and data.</li>
                </ul>
            </li>
        </ol>

        <h2 id="best-practices-and-troubleshooting">15. Best Practices & Troubleshooting</h2>
        <h3>A. Best Practices:</h3>
        <ul>
            <li><strong>Phased Deployment:</strong> Deploy Sentinel in phases, starting with essential data connectors and a pilot group.</li>
            <li><strong>KQL Mastery:</strong> Continuously learn and practice KQL for effective hunting, investigation, and rule creation.</li>
            <li><strong>Tune Analytics Rules:</strong> Regularly review and fine-tune rules to minimize false positives and maximize true positives. Use the "Play with current query in Log Analytics" option to refine rules.</li>
            <li><strong>Leverage Built-in Content:</strong> Explore the vast library of out-of-the-box data connectors, analytics rules, workbooks, and hunting queries in the **Content Hub**.</li>
            <li><strong>Implement Automation:</strong> Use **Automation Rules** and **Playbooks** to automate repetitive tasks for faster response and reduced analyst workload.</li>
            <li><strong>Integrate Threat Intelligence:</strong> Enrich your detections with relevant IOCs from various sources.</li>
            <li><strong>Use Incidents Effectively:</strong> Triage, investigate, assign, and close incidents systematically. Leverage the Investigation Graph.</li>
            <li><strong>Regular Hunting:</strong> Proactively search for threats that evade automated detections.</li>
            <li><strong>Monitor Costs:</strong> Keep a close eye on data ingestion and retention costs.</li>
            <li><strong>Security Hygiene:</strong> Sentinel is powerful, but good foundational security practices (patching, MFA, least privilege) are still critical.</li>
        </ul>

        <h3>B. Troubleshooting:</h3>
        <ul>
            <li><strong>Data Ingestion:</strong>
                <ul>
                    <li>Check the **Data Connectors** page for "Last Data Received" status.</li>
                    <li>Run simple `&lt;TableName&gt; | take 10` queries in **Logs** to verify data flow.</li>
                    <li>For agent-based connectors, verify the Log Analytics agent status on the source machine and check relevant system logs.</li>
                    <li>Check network connectivity and firewall rules between data sources and the Log Analytics workspace.</li>
                </ul>
            </li>
            <li><strong>Alerts Not Firing:</strong>
                <ul>
                    <li>Check the **Analytics rules** page for the rule's status (Enabled/Disabled).</li>
                    <li>Go to the rule's **Edit** page &gt; **Set rule logic** tab &gt; **Play with current query in Log Analytics** to manually run the KQL query. Does it return results?</li>
                    <li>Verify "Query scheduling" and "Alert threshold" in the rule configuration.</li>
                    <li>Ensure data relevant to the rule is actually being ingested into the correct tables.</li>
                </ul>
            </li>
            <li><strong>Incident Not Created/Playbook Not Running:</strong>
                <ul>
                    <li>Check the **Analytics rule**'s "Automated response" tab to ensure a playbook is attached.</li>
                    <li>Go to **Automation rules** and verify the rule is configured correctly to trigger for your incident type and that its conditions are met.</li>
                    <li>For Playbooks, go to the specific Logic App in the Azure Portal (search for "Logic apps") and check its **Run history** for failures and details.</li>
                    <li>Verify permissions of the Playbook's Managed Identity (IAM roles).</li>
                </ul>
            </li>
            <li><strong>Permissions:</strong> Double-check that your user account or service principal has the necessary Azure RBAC roles for the operations you're trying to perform.</li>
            <li><strong>Resource Health:</strong> Monitor the health and performance of your Log Analytics Workspace in Azure Monitor (Azure Portal &gt; Log Analytics workspaces).</li>
            <li><strong>Microsoft Learn & Community:</strong> The <a href="https://learn.microsoft.com/en-us/azure/sentinel/" target="_blank">official Microsoft Sentinel documentation</a> and the Microsoft Tech Community are excellent resources for troubleshooting.</li>
        </ul>

        <div class="tip">
            **Empowering Your SOC with Microsoft Sentinel!**
            <p>Microsoft Sentinel, especially through the unified Microsoft Defender portal, transforms security operations by providing a cloud-native, AI-driven SIEM and SOAR solution. By mastering data ingestion, KQL querying, rule creation, incident investigation, and automation with playbooks, your security team can achieve unparalleled visibility and response capabilities, significantly enhancing your organization's cybersecurity posture.</p>
        </div>
    </div>
</body>
</html>
